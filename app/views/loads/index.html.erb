<h1>Loads</h1>
<%= paginate @loads %>
<%= search_form_for @search do |f| %>  
<%= link_to "Reload", 
loads_path, class: 'btn btn-hrcprimary btn-xs round'%>
<br />
<div>
<%= f.label :load_search_params_cont, "Search" %>  
<%= f.text_field :load_search_params_cont %>     


</div>
<div>
<%= f.label :rate_gteq, "Rate Between" %>  
<%= f.text_field :rate_gteq %>     
<%= f.label :rate_lteq, "and" %>  
<%= f.text_field :rate_lteq %> 

</div>
<div>
<%= f.label :created_at_gteq, "Dates Between" %>  
<%= f.date_select :created_at_gteq, order: [:month, :day, :year], include_blank: true,
            placeholder: " Select Date" %> 


<%= f.label :created_at_lteq, "and" %>  
<%= f.date_select :created_at_lteq, order: [:month, :day, :year], include_blank: true,
            placeholder: " Select Date" %> 
<br />            
<%= f.submit "Search", class: 'btn btn-hrcsuccess btn-xs round' %> 
</div>
<% end %>

<table class="table table-bordered table-striped table-condensed table-responsive">
  <thead>
    <tr>
      <th><%= sort_link @search, :id, "ID" %></th>
      <th><%= sort_link @search, :created_at, "Booked On" %></th>
      <th>Description</th>
      <th>Driver</th>
      <th>Shipper/Broker</th>
      <th><%= sort_link @search, :commodity, "Commodity" %></th>
      <th><%= sort_link @search, :weight, "Weight" %></th>
      <th><%= sort_link @search, :load_size, "Load Size" %></th>
      <th><%= sort_link @search, :rate, "HRC Rate" %></th>
      <th>Driver Rate</th>
      <th><%= sort_link @search, :miles, "Distance (Miles)" %></th>
      <th>Load Expenses</th>
      <th>Pick up time</th>
      <th>Delivery time</th>
      <th><%= sort_link @search, :equipment_type, "Trailer Type" %></th>
      <th><%= sort_link @search, :status_name, "Status" %></th>       
      <th colspan="3"></th>
    </tr>
  </thead>
  <tbody>
    <% expense_running_total = 0.00 %>
    <% hrc_load_running_total = 0.00 %>
    <% total_miles = 0 %>
    <% driver_load_running_total = 0.00 %>
    <% @loads.each do |load| %>
    <tr>
      <td>
        <%= link_to load do %>
        <%= load.id %>
        <% end %>
      </td>
      <td><%= (load.created_at.strftime("%A %B %-d, %Y")) %></td>
      <td>
        <%= link_to load do %>
        <%= load.load_title %> 
        <% end %>
      </td>
      <td>
        <% if current_hrc_user %>
        <%= link_to driver_user_path(load.driver_user_id) do %>
        <%= load.driver_user.full_name %>
        <% end %>
        <% end %>
      </td>
      <td>
        <%= link_to company_profile_path(load.company_profile) do %>
        <%= load.company_profile.company_name %>
        <% end %>
      </td>
      <td><%= load.commodity %></td>
      <td><%= load.weight %></td>
      <td><%= load.load_size %></td>
      <td>
        <%= number_to_currency(load.rate) %>
      </td>
      <td><%= number_to_currency(load.rate_to_driver) %></td>
      <td><%= load.miles %> </td>
      <td>
        <% load.load_expenses.each do |le| %>
        <%= number_to_currency(le.amount) %>
        <% expense_running_total = expense_running_total + le.amount %>
        <% end %>
      </td>
      <td>
        <%= (load.pick_up_date.strftime("%A %B %-d, %Y")) %>
        @ <%= (load.pick_up_time.strftime("%-l:%M %p")) %> 
      </td>
      <td>
        <%= (load.delivery_date.strftime("%A %B %-d, %Y")) %>
        @ <%= (load.delivery_time.strftime("%-l:%M %p")) %>
      </td>
      <td><%= load.equipment_type %></td>
      <td><%= load.status_name %></td>
<td>
  <div class="btn-group pull-right activity-actions">
    <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown">
    <i class="fa fa-th"></i>
    <span class="sr-only">Toggle Dropdown</span>
    </button>
    <ul class="dropdown-menu dropdown-menu-right" role="menu">
      <li><%= link_to 'Show', load %></li>
      <li><%= link_to 'Edit', edit_load_path(load) %></li>
      <li class="divider"></li>
      <li><%= link_to 'Destroy', load, method: :delete, data: { confirm: 'Are you sure?' } %></li>
    </ul>
  </div>
</td>
    </tr>
    <% hrc_load_running_total = hrc_load_running_total + load.rate %> 
    <% driver_load_running_total = driver_load_running_total + load.rate_to_driver %> 
    <% total_miles = total_miles + load.miles %>

    <% end %>
  </tbody>
</table>
<br>
<% driver_net = driver_load_running_total - expense_running_total %>
<% hrc_net = hrc_load_running_total - driver_load_running_total %>
<%= link_to 'New Load', new_load_path, class: "btn btn-hrcprimary round btn-xs" %>
 <%= link_to "Download Loads", loads_path(format: :csv), class: "btn btn-primary btn-xs round" %> 
<br />
<br /> 
<div class="col-lg-4">
  <div class="panel panel-success">
    <div class="panel-heading">
      <p>Gross HRC Income <%= number_to_currency(hrc_load_running_total) %></p>
      <p>Total Miles <%= total_miles %></p>
    </div>
    <div class="panel-body">
      <p>Net HRC Income <%= number_to_currency(hrc_net) %></p>
      <p>HRC Net RPM <%= number_to_currency(hrc_net / total_miles) %></p>
    </div>
    <div class="panel-footer">
      <p>Expenses <%= number_to_currency(expense_running_total) %></p>
      <p>Gross Driver Income <%= number_to_currency(driver_load_running_total) %></p>
      <p> Driver Net Income <%= number_to_currency(driver_net) %></p>
      <p>Driver Gross RPM <%= number_to_currency(driver_load_running_total / total_miles) %></p>
      <p>Driver Net RPM <%= number_to_currency(driver_net / total_miles) %></p>
    </div>
  </div>
</div>

  <div class="row">
  <div class="col-sm-3">
    <h4>Import Loads</h4>
    <%= form_tag import_loads_path, multipart: true do %>
    <%= file_field_tag :file, class: "btn btn-success btn-xs" %><br>
    <%= submit_tag "Upload Loads", class: "btn btn-info btn-xs" %>
    <% end %>
  </div>
  <div class="col-sm-4">
<h4>Export Loads</h4>
  <%= link_to "Download Loads", loads_path(format: :csv), 
  class: "btn btn-primary btn-xs round" %> 

<%= link_to 'New Load', new_load_path %>
  </div>
</div> 